<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vcenter | 电脑]]></title>
  <link href="http://nanliu.github.com/blog/categories/vcenter/atom.xml" rel="self"/>
  <link href="http://nanliu.github.com/"/>
  <updated>2013-02-28T08:45:02-08:00</updated>
  <id>http://nanliu.github.com/</id>
  <author>
    <name><![CDATA[Nan Liu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Puppet Managing vCenter and vShield]]></title>
    <link href="http://nanliu.github.com/blog/2013/02/27/puppet-managing-vcenter-and-vshield/"/>
    <updated>2013-02-27T08:00:00-08:00</updated>
    <id>http://nanliu.github.com/blog/2013/02/27/puppet-managing-vcenter-and-vshield</id>
    <content type="html"><![CDATA[<p>Today, we released a set of <a href="https://github.com/vmware/">open source Puppet modules</a> for managing <a href="http://www.vmware.com/products/vcenter-server/overview.html">vCenter</a> Server Appliance 5.1 and <a href="http://www.vmware.com/products/datacenter-virtualization/vcloud-network-security/overview.html">vCloud Network and Security</a> 5.1 (vCNS previously known as vShield). They provide a framework for managing resources within vCenter and vCNS via Puppet<sup id="fnref:fn-nick"><a href="#fn:fn-nick" rel="footnote">1</a></sup>.</p>

<p><img src="/images/puppet_device.png" title="‘Puppet and vSphere vShield API’" ></p>

<p>The modules can be obtained from <a href="http://forge.puppetlabs.com/vmware">forge.puppetlabs.com</a>:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ puppet module install vmware/vcsa
</span><span class='line'>$ puppet module install vmware/vcenter
</span><span class='line'>$ puppet module install vmware/vshield</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>For development use github repos which can be installed via the following librarian Puppetfile:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">puppetlabs</span><span class="o">/</span><span class="n">stdlib</span><span class="err">”</span>
</span><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">nanliu</span><span class="o">/</span><span class="n">staging</span><span class="err">”</span>
</span><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">vmware_lib</span><span class="err">”</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vmware</span><span class="o">/</span><span class="n">vmware</span><span class="o">-</span><span class="n">vmware_lib</span><span class="o">.</span><span class="n">git</span><span class="err">”</span>
</span><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">vcsa</span><span class="err">”</span><span class="p">,</span>       <span class="ss">:git</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vmware</span><span class="o">/</span><span class="n">vmware</span><span class="o">-</span><span class="n">vcsa</span><span class="o">.</span><span class="n">git</span><span class="err">”</span>
</span><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">vcenter</span><span class="err">”</span><span class="p">,</span>    <span class="ss">:git</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vmware</span><span class="o">/</span><span class="n">vmware</span><span class="o">-</span><span class="n">vcenter</span><span class="o">.</span><span class="n">git</span><span class="err">”</span>
</span><span class='line'><span class="n">mod</span> <span class="err">“</span><span class="n">vshield</span><span class="err">”</span><span class="p">,</span>    <span class="ss">:git</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vmware</span><span class="o">/</span><span class="n">vmware</span><span class="o">-</span><span class="n">vshield</span><span class="o">.</span><span class="n">git</span><span class="err">”</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The puppet management host needs to have connectivity with vCenter and vCNS appliance. We are currently using a custom version of <a href="https://github.com/vmware/rbvmomi">RbVmomi</a> which has been included in the module. The management host should deploy all dependent software packages before managing any vCenter/vCNS resources:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">node</span> <span class="err">‘</span><span class="n">management_server</span><span class="err">’</span> <span class="p">{</span>
</span><span class='line'>  <span class="kp">include</span> <span class="err">‘</span><span class="ss">vcenter</span><span class="p">:</span><span class="ss">:package</span><span class="err">’</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>One of the gems in the package requires nokogiri. If you use Puppet Enterprise, install the pe-rubygem-nokogiri package on the management host (it’s not typically installed for agents). See <a href="http://nokogiri.org/tutorials/installing_nokogiri.html">Nokogiri documentation</a> for additional information for open source puppet agents.</p>

<p>In last week’s <a href="http://nanliu.github.com/blog/2013/02/20/device-management-with-puppet/">sneak preview</a>, I showed the debugging output for ssh transport. For the observant readers, those commands were the steps to initialize vCenter Server Appliance<sup id="fnref:fn-will"><a href="#fn:fn-will" rel="footnote">2</a></sup>:</p>

<p><img src="/images/vcsa_ssh.png" title="‘vCenter Server Appliance initialization’" ></p>

<p>This is the corresponding Puppet manifests<sup id="fnref:fn-import"><a href="#fn:fn-import" rel="footnote">3</a></sup>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vcsa</span> <span class="p">{</span> <span class="err">‘</span><span class="n">demo</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="n">username</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">root</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">password</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">vmware</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">server</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">10</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">db_type</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">embedded</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">capacity</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">m</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If we dig into the define resources type, it simply passes the user account to the ssh transport and initialize the device in the appropriate sequence:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">define</span> <span class="n">vcsa</span> <span class="p">(</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transport</span> <span class="p">{</span> <span class="vg">$name</span><span class="p">:</span>
</span><span class='line'>    <span class="n">username</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="vg">$username</span><span class="p">,</span>
</span><span class='line'>    <span class="n">password</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="vg">$password</span><span class="p">,</span>
</span><span class='line'>    <span class="n">server</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="vg">$server</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vcsa_eula { $name:</span>
</span><span class='line'><span class="sr">    ensure    =&amp;gt; accept,</span>
</span><span class='line'><span class="sr">    transport =&amp;gt; Transport[$name],</span>
</span><span class='line'><span class="sr">  } -&amp;gt;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">vcsa_db</span> <span class="p">{</span> <span class="vg">$name</span><span class="p">:</span>
</span><span class='line'>    <span class="k">ensure</span>    <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>    <span class="n">type</span>      <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="vg">$db_type</span>
</span><span class='line'>  <span class="err">…</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Once vCenter Server appliance is initialized we can manage vCenter resources using the vSphere API. The example below specifies a vSphere API transport, along with datacenter, cluster, and an ESX host<sup id="fnref:fn-windows"><a href="#fn:fn-windows" rel="footnote">4</a></sup>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">transport</span> <span class="p">{</span> <span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="n">username</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">root</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">password</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">vmware</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">server</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">10</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="c1"># see rbvmomi documentation for available options:</span>
</span><span class='line'>  <span class="n">options</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span> <span class="err">‘</span><span class="n">insecure</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="kp">true</span> <span class="p">},</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vc_datacenter { ‘dc1’:</span>
</span><span class='line'><span class="sr">  ensure    =&amp;gt; present,</span>
</span><span class='line'><span class="sr">  path      =&amp;gt; ‘/</span><span class="n">dc1</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">transport</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vc_cluster { ‘/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="k">ensure</span>    <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>  <span class="n">transport</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vc_cluster_drs { ‘/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="nb">require</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Vc_cluster</span><span class="o">[</span><span class="err">‘</span><span class="o">/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">before</span>    <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Anchor</span><span class="o">[</span><span class="err">‘</span><span class="o">/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">transport</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vc_cluster_evc { ‘/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="nb">require</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">[</span>
</span><span class='line'>    <span class="no">Vc_cluster</span><span class="o">[</span><span class="err">‘</span><span class="o">/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>    <span class="no">Vc_cluster_drs</span><span class="o">[</span><span class="err">‘</span><span class="o">/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">before</span>    <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Anchor</span><span class="o">[</span><span class="err">‘</span><span class="o">/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">transport</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;anchor { ‘/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="p">:</span> <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vcenter::host { ‘esx1’:</span>
</span><span class='line'><span class="sr">  path      =&amp;gt; ‘/</span><span class="n">dc1</span><span class="o">/</span><span class="n">clu1</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">username</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">root</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">password</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">esx_password</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">dateTimeConfig</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
</span><span class='line'>    <span class="err">‘</span><span class="n">ntpConfig</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
</span><span class='line'>      <span class="err">‘</span><span class="n">server</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">us</span><span class="o">.</span><span class="n">ntp</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">org</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="err">‘</span><span class="n">timeZone</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
</span><span class='line'>      <span class="err">‘</span><span class="n">key</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="no">UTC</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="n">transport</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next task is to connect vCloud Network and Security appliance to a vCenter appliance to form a cell:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">transport</span> <span class="p">{</span> <span class="err">‘</span><span class="n">vshield</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="n">username</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">admin</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">password</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">default</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">server</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;vshield_global_config { $vshield[‘server’]:</span>
</span><span class='line'><span class="sr">  vc_info   =&amp;gt; {</span>
</span><span class='line'><span class="sr">    ip_address =&amp;gt; ‘192.168.1.10’,</span>
</span><span class='line'><span class="sr">    user_name  =&amp;gt; ‘admin’,</span>
</span><span class='line'><span class="sr">    password   =&amp;gt; ‘default’,</span>
</span><span class='line'><span class="sr">  },</span>
</span><span class='line'><span class="sr">  time_info =&amp;gt; { ‘ntp_server’ =&amp;gt; ‘us.pool.ntp.org’ },</span>
</span><span class='line'><span class="sr">  dns_info  =&amp;gt; { ‘primary_dns’ =&amp;gt; ‘8.8.8.8’ },</span>
</span><span class='line'><span class="sr">  transport =&amp;gt; Transport[‘vshield’],</span>
</span><span class='line'><span class="sr">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>In vShield API, all vCenter resources are referred by the <a href="http://kb.vmware.com/kb/1017126">vSphere Managed Object Reference (MoRef)</a>. ‘esx-13’ might be understandable to a computer, but for configuration purpose the name of the ESX host would make much more sense to an admin. For this reason, we developed the transport resource to support multiple connectivity during a single puppet execution:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">transport</span> <span class="p">{</span> <span class="err">‘</span><span class="n">vcenter</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="n">username</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">root</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">password</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">vmware</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">server</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">10</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">options</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span> <span class="err">‘</span><span class="n">insecure</span><span class="err">’</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="kp">true</span> <span class="p">},</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;transport { ‘vshield’:</span>
</span><span class='line'><span class="sr">  username =&amp;gt; ‘admin’,</span>
</span><span class='line'><span class="sr">  password =&amp;gt; ‘default’,</span>
</span><span class='line'><span class="sr">  server   =&amp;gt; ‘192.168.1.11’,</span>
</span><span class='line'><span class="sr">}&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">vshield_edge</span> <span class="p">{</span> <span class="err">‘</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="ss">:dmz</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>  <span class="k">ensure</span>             <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>  <span class="n">datacenter_name</span>    <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">dc1</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">resource_pool_name</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">clu1</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">enable_aesni</span>       <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="kp">false</span><span class="p">,</span>
</span><span class='line'>  <span class="n">enable_fips</span>        <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="kp">false</span><span class="p">,</span>
</span><span class='line'>  <span class="n">enable_tcp_loose</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="kp">false</span><span class="p">,</span>
</span><span class='line'>  <span class="n">vse_log_level</span>      <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">info</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">fqdn</span>               <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">dmz</span><span class="o">.</span><span class="n">vm</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>  <span class="n">vnics</span>              <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">[</span>
</span><span class='line'>    <span class="p">{</span> <span class="nb">name</span>          <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="n">uplink</span><span class="o">-</span><span class="nb">test</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>      <span class="n">portgroupName</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘</span><span class="no">VM</span> <span class="no">Network</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>      <span class="n">type</span>          <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="no">Uplink</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>      <span class="n">isConnected</span>   <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="kp">true</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>      <span class="n">addressGroups</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
</span><span class='line'>        <span class="err">“</span><span class="n">addressGroup</span><span class="err">”</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
</span><span class='line'>          <span class="err">“</span><span class="n">primaryAddress</span><span class="err">”</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>          <span class="err">“</span><span class="n">subnetMask</span><span class="err">”</span>     <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">“</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">128</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>  <span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">transport</span>  <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Transport</span><span class="o">[</span><span class="err">‘</span><span class="n">vshield</span><span class="err">’</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This should a provide general overview for the module capabilities. Additional resources are available beyond what’s covered in this post, however some of them such as vc_vm are not operational yet, and currently the modules do not offer comprehensive coverage of the vSphere and vShield API. I hope other users will find this module useful for your environment.</p>

<p>Thanks again for the support from R&amp;D team at VMware, and especially Randy Brown and Shawn Holland for contributing the vCenter and vShield module. Also thanks to Rich Lane for releasing RbVmomi, and support from Christian Dickmann for resolving an issue in that library.</p>

<h3 id="reference">Reference:</h3>

<p>VMware github repository:</p>

<ul>
  <li><a href="https://github.com/vmware/vmware-vmware_lib">vmare_lib</a></li>
  <li><a href="https://github.com/vmware/vmware-vcsa">vcsa</a></li>
  <li><a href="https://github.com/vmware/vmware-vcenter">vcenter</a></li>
  <li><a href="https://github.com/vmware/vmware-vshield">vshield</a></li>
</ul>

<p>Video walkthrough:</p>

<p><div class="embed-video-container"><iframe src="http://player.vimeo.com/video/60628331 "></iframe></div></p>

<div class="footnotes">
  <ol>
    <li id="fn:fn-nick">
      <p>See <a href="http://nickapedia.com/2013/02/27/vmware-puppet-one-more-step-forward">Nick’s blog post</a> for more info.<a href="#fnref:fn-nick" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:fn-will">
      <p>Thanks to <a href="http://www.virtuallyghetto.com/2012/02/automating-vcenter-server-appliance.html">Will Lam’s post on vCenter appliance</a>.<a href="#fnref:fn-will" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:fn-import">
      <p>In the module test manifests “import ‘data.pp’” is a pattern to simplify testing for developers in different environments, please do not use import function for your production puppet manifests.<a href="#fnref:fn-import" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:fn-windows">
      <p>Also the resources should work against a vCenter installation on Windows, however it hasn’t been tested.<a href="#fnref:fn-windows" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
  </entry>
  
</feed>
